import{css as w,LitElement as $,html as m,svg as x}from"lit";import{classMap as I}from"lit-html/directives/class-map.js";import O from"qrcode";const B=w`.o21pay-payment-full{display:inline-block;overflow:hidden;position:relative;box-shadow:rgb(0 0 0 / 35%) 0 5px 15px;transition:all .2s linear;border:1px solid #d3d3d3;padding:10px;cursor:initial;border-radius:15px;background-color:#fff}.o21pay-edit{text-align:center}.o21pay-input{font-size:18px;border:1px solid #d3d3d3;border-radius:5px;padding:10px;box-sizing:border-box}.o21pay-button{background-image:url(https://assets.obvious21.com/o21pay-assets/o21pay-button.png);background-repeat:no-repeat;background-size:auto 25px;background-position:22px 8px;background-color:#68d18d;border-color:#68d18d;color:#fff;font-weight:400;vertical-align:middle;border:1px solid transparent;background-position:top 10px;font-size:1rem;line-height:1.5;height:40px;width:140px;border-radius:20px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}.o21pay-button:hover{color:#fff;background-color:#218838;border-color:#1e7e34}#amount{margin-top:5px;width:200px;text-align:center}#order_ref{margin-top:5px;width:200px;margin-bottom:3px;text-align:center}#suggestion{display:none}#page2{display:none}#o21pay-qr{float:left}@media screen and (max-width:1023px){.o21pay-p-vc{display:none}}@media only screen and (min-width:1024px){.o21pay-p-vc{vertical-align:middle;display:table-cell;height:190px;padding-left:20px;padding-right:20px;text-align:center}}.o21pay-poweredby{margin:0;font-size:12px;color:#778899}.close{z-index:9999;position:absolute;top:10px;right:15px;width:20px;height:20px;opacity:.3;cursor:pointer;visibility:hidden}.close:hover{opacity:1}.close:after,.close:before{position:absolute;left:15px;content:" ";height:20px;width:2px;background-color:#000}.close:before{transform:rotate(45deg)}.close:after{transform:rotate(-45deg)}.divider{position:absolute;left:220px;width:200px;bottom:70px;right:20px;border:2px solid #9fd3b1;border-radius:2px}.o21pay-tag{background-color:rgb(119 136 153);display:inline-block;height:32px;padding:0 16px;line-height:30px;font-size:12px;color:#fff;border:1px solid #909399;border-radius:16px;box-sizing:border-box;white-space:nowrap;margin-left:2px;margin-right:2px;cursor:pointer}@keyframes zoom-in-zoom-out{0%{transform:scale(1,1)}50%{transform:scale(1.1,1.1)}100%{transform:scale(1,1)}}`,T="http://localhost:3400/api/v1/";var L=Object.defineProperty,X=(r,t,e)=>t in r?L(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,V=(r,t,e)=>(X(r,typeof t!="symbol"?t+"":t,e),e);const A=()=>navigator.userLanguage||navigator.languages&&navigator.languages.length&&navigator.languages[0]||navigator.language||navigator.browserLanguage||navigator.systemLanguage||"en";class q extends ${static get properties(){return{merchant_id:{type:String,attribute:"merchant_id"},secretkey:{type:String,attribute:"secretkey"},apiurl:{type:String,attribute:"apiurl"},form:{type:Boolean,attribute:"form"},amount:{type:String,attribute:"amount"},order_ref:{type:String,attribute:"order_ref"},hidden_order_ref:{type:Boolean,attribute:"hidden_order_ref"},suggestion:{type:String,attribute:"suggestion"},readonly:{type:Boolean,attribute:"readonly"},disabled:{type:Boolean,attribute:"disabled"},texts:{type:Array,attribute:"texts"}}}constructor(){super(),this.form=!1,this.url="",this.amount="",this.apiurl=T,this.currency="EUR",this.suggestion="",this.arraySuggestion=[],this.texts={TXT_PR_LINE1:"To proceed to payment, you can either click",TXT_PR_LINE2:"on the QR-Code either scan with your mobile"},navigator&&(this.locale=A())}init(t,e){this.url="";let i=this.renderRoot.querySelector(".o21pay-payment-full");i.style.removeProperty("height"),this.renderRoot.querySelector(".close").style.visibility="hidden",this.renderRoot.querySelector(".o21pay-edit").hidden=!1,i=this.renderRoot.querySelector("#suggestion"),!this.suggestion||!this.suggestion.length?i.style.display="none":i.style.display="block",i=this.renderRoot.querySelector("#page2"),i.style.display="none",t&&(this.amount=t),this.order_ref=e||""}async _paymentRequest(t,e,i,o,s){const p=this.apiurl+`merchants/${t}/paymentRequest`,h={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({secretkey:e,amount:i,currency_code:o,order_ref:s})},l=await(await fetch(p,h)).json();return l.data?l.data.url:(console.log(l),null)}async _onO21Pay(t){if(!this.merchant_id||!this.merchant_id.length){alert("Missing merchant_id");return}let e=this.renderRoot.querySelector("#amount");if(e){let o=e.value;o=o.replace(",","."),o=o.replace("\u20AC",""),this.amount=o}if(!this.amount||!this.amount.length){alert("Missing Amount");return}if(e=this.renderRoot.querySelector("#order_ref"),e&&(this.order_ref=e.value),!this.order_ref||!this.order_ref.length){alert("Missing order_ref");return}const i=await this._paymentRequest(this.merchant_id,this.secretkey,this.amount,"EUR",this.order_ref);if(i&&i.length){this.url=i;const o={detail:{url:this.url},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("o21pay_payment_request",o));let s=this.renderRoot.querySelector(".o21pay-payment-full");if(this.form){this.renderRoot.querySelector(".o21pay-edit").hidden=!0,s.style.height="200px",this.renderRoot.querySelector(".close").style.visibility="visible";const p=this;s=p.renderRoot.querySelector("o21pay-qr"),s.url=p.url,s=this.renderRoot.querySelector("#suggestion"),s.style.display="none",s=p.renderRoot.querySelector("#page2"),s.style.display="block"}else s&&(s.style.height="52px")}}onInit(t){this.init(this.amount,"")}onFocus(t){const e=t.target;return e.readOnly===!0?null:(e.type="number",e.value=e.lastValue,e.value)}onBlur(t){const e=t.target;e.value||(e.value=0),e.lastValue=e.value,this.amount=e.value}changeViewInput(t){if(!t)return;let e=this.amount;e||(e=0),t.type="",t.lastValue=e,t.value=parseFloat(e).toLocaleString(this.locale,{style:"currency",maximumFractionDigits:2,minimumFractionDigits:2,currency:this.currency,currencyDisplay:"symbol"})}_onTag(t){let e=t.target.dataset.source;e&&(e=parseFloat(e),this.amount=e)}updated(t){if(t.has("amount")){const e=this.renderRoot.getElementById("amount");this.changeViewInput(e)}if(t.has("readonly")){let e=this.renderRoot.getElementById("amount");e&&e.setAttribute("readonly","readonly"),e=this.renderRoot.getElementById("order_ref"),e&&e.setAttribute("readonly","readonly")}if(t.has("disabled")){let e=this.renderRoot.getElementById("amount");e&&e.setAttribute("disabled","disabled"),e=this.renderRoot.getElementById("order_ref"),e&&e.setAttribute("disabled","disabled")}if(t.has("hidden_order_ref")){let e=this.renderRoot.getElementById("order_ref");e&&e.setAttribute("hidden","hidden")}if(t.has("suggestion")){let e=this.renderRoot.getElementById("suggestion");e?!this.suggestion||!this.suggestion.length?(this.arraySuggestion=[],e.style.display="none"):(this.arraySuggestion=this.suggestion.split(","),e.style.display="block"):this.arraySuggestion=[],this.requestUpdate()}}render(){return this.form===!0?m`<div class="o21pay-payment-full"><div class="close" @click="${this.onInit}"></div><div class="o21pay-edit"><input id="amount" class="o21pay-input" type="number" min="0.00" max="15000.00" step="0.01" .value="${this.amount}" placeholder="0.00" @focus="${this.onFocus}" @blur="${this.onBlur}"> <input id="order_ref" class="o21pay-input" type="text" .value="${this.order_ref}" placeholder="Your Order Reference" style="margin-left:10px"> Â  <button class="o21pay-button" @click="${this._onO21Pay}"></div><div id="suggestion" style="margin-top:10px;animation:zoom-in-zoom-out .8s ease 1">${this.arraySuggestion.map(t=>m`<span class="o21pay-tag" data-source="${t}" @click="${this._onTag}">${parseFloat(t).toLocaleString(this.locale,{style:"currency",maximumFractionDigits:2,minimumFractionDigits:2,currency:this.currency,currencyDisplay:"symbol"})}</span>`)}</div><div id="page2"><o21pay-qr id="o21pay-qr" size="180" theme="dark" shadow></o21pay-qr><div class="o21pay-p-vc">${this.texts.TXT_PR_LINE1}<br>${this.texts.TXT_PR_LINE2}</div><hr class="divider"></div></div><div class="o21pay-poweredby"><svg style="position:relative;top:2px" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10.5C19.6569 10.5 21 11.8431 21 13.5V19.5C21 21.1569 19.6569 22.5 18 22.5H6C4.34315 22.5 3 21.1569 3 19.5V13.5C3 11.8431 4.34315 10.5 6 10.5V7.5C6 4.18629 8.68629 1.5 12 1.5C15.3137 1.5 18 4.18629 18 7.5V10.5ZM12 3.5C14.2091 3.5 16 5.29086 16 7.5V10.5H8V7.5C8 5.29086 9.79086 3.5 12 3.5ZM18 12.5H6C5.44772 12.5 5 12.9477 5 13.5V19.5C5 20.0523 5.44772 20.5 6 20.5H18C18.5523 20.5 19 20.0523 19 19.5V13.5C19 12.9477 18.5523 12.5 18 12.5Z" fill="currentColor"/></svg> <span>Payment secured and powered by O21Pay</span></div>`:m`<button class="o21pay-button" @click="${this._onO21Pay}">`}}V(q,"styles",[B]);window.customElements.define("o21pay-payment",q);const D=w`.wrapper{opacity:0;z-index:10;transition:opacity .25s ease-in}.wrapper:not(.open){visibility:hidden}.wrapper.open{opacity:1;visibility:visible}.overlay{background:rgba(0,0,0,.4);height:100%;width:100%;top:0;left:0;position:fixed}.dialog{background:#e1e4f0;border-radius:10px;padding:0;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:100px;height:100px;z-index:9998;box-shadow:rgba(0,0,0,.35) 0 5px 15px}.drawer{position:absolute;box-sizing:border-box;background-color:#e1e4f0;display:flex;flex-direction:column;overflow:hidden;outline:0;top:0;bottom:0;height:100%;z-index:9998;box-shadow:0 8px 10px -5px rgb(0 0 0 / 20%),0 16px 24px 2px rgb(0 0 0 / 14%),0 6px 30px 5px rgb(0 0 0 / 12%)}.drawer-header{align-items:center;color:#72767b;display:flex;margin-bottom:32px;padding:10px 20px 0}.close{z-index:9999;position:absolute;top:-25px;right:10px;width:20px;height:20px;opacity:.3;cursor:pointer}.close-drawer-left{top:10px!important;left:10px!important}.close-drawer-right{top:10px!important;right:20px!important}.close:hover{opacity:1}.close:after,.close:before{position:absolute;left:15px;content:" ";height:20px;width:2px;background-color:#000}.close:before{transform:rotate(45deg)}.close:after{transform:rotate(-45deg)}.orbit-spinner-text{position:absolute;left:50%;top:43%;transform:translate(-50%,-43%);z-index:2;text-align:center}.orbit-spinner,.orbit-spinner *{box-sizing:border-box}.orbit-spinner{height:55px;width:55px;border-radius:50%;perspective:800px;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:48px;height:48px;z-index:2}.orbit-spinner .orbit{position:absolute;box-sizing:border-box;width:100%;height:100%;border-radius:50%}.orbit-spinner .orbit:nth-child(1){left:0;top:0;animation:orbit-spinner-orbit-one-animation 1.2s linear infinite;border-bottom:3px solid #ff1d5e}.orbit-spinner .orbit:nth-child(2){right:0;top:0;animation:orbit-spinner-orbit-two-animation 1.2s linear infinite;border-right:3px solid #ff1d5e}.orbit-spinner .orbit:nth-child(3){right:0;bottom:0;animation:orbit-spinner-orbit-three-animation 1.2s linear infinite;border-top:3px solid #ff1d5e}@keyframes orbit-spinner-orbit-one-animation{0%{transform:rotateX(35deg) rotateY(-45deg) rotateZ(0)}100%{transform:rotateX(35deg) rotateY(-45deg) rotateZ(360deg)}}@keyframes orbit-spinner-orbit-two-animation{0%{transform:rotateX(50deg) rotateY(10deg) rotateZ(0)}100%{transform:rotateX(50deg) rotateY(10deg) rotateZ(360deg)}}@keyframes orbit-spinner-orbit-three-animation{0%{transform:rotateX(35deg) rotateY(55deg) rotateZ(0)}100%{transform:rotateX(35deg) rotateY(55deg) rotateZ(360deg)}}.obv-frameContainerStyle{border-radius:10px}.obv-frameStyle{border:0;border-radius:10px}iframe{width:100%;height:100%}`;var M=Object.defineProperty,N=(r,t,e)=>t in r?M(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,F=(r,t,e)=>(N(r,typeof t!="symbol"?t+"":t,e),e);class C extends ${static get properties(){return{width:{type:String,attribute:"width"},height:{type:String,attribute:"height"},mode:{type:String,attribute:"mode"},url:{type:String},open:{type:Boolean},hideSpinner:{type:Boolean},texts:{type:Array,attribute:"texts"},events:{hasChanged(t,e){return!0}}}}constructor(){super(),this.open=!1,this.oribitStyle="borderColor: red; animationDuration: 1000ms;",this.width="375px",this.height="560px",this.modal="dialog",this.texts={TXT_CNX:"Connection in progress..."}}updated(t){if(t.has("events")){const e=t.get("events"),i=this.events;e&&window.removeEventListener("message",e);const o=this;window.addEventListener("message",function(s){if(s&&s.data){const p=s.data;if(p){const h=p.message;if(h==="o21pay_ready"){const l=o.shadowRoot.getElementById("framePayment");l&&(l.style.opacity=1)}i&&h&&i(p)}}})}super.updated(t)}init(t,e,i,o="dialog"){if(!t||!t.length)return!1;e!==void 0&&(this.width=e),i!==void 0&&(this.height=i),o!==void 0&&(this.mode=o),this.hideSpinner=!1,t+=`&time=${new Date().getTime()}`;const s=this.renderRoot.querySelector("#framePayment");return s?(s.style.opacity=0,this.mode.indexOf("drawer")===-1&&t.indexOf("&close")===-1&&(t+="&close"),t.indexOf("&reset")===-1&&(t+="&reset"),s.src=t,!0):!1}reset(){const t=this.shadowRoot.getElementById("framePayment");t.src="about:blank"}spinnerStyle(){return"display: "+(this.hideSpinner?"none":"block")}closeWindow(){this.open=!1,this.events&&this.events({message:"o21pay_closed"}),this.reset()}render(){let t="dialog",e="",i="close",o=`width:${this.width}; height:${this.height}`;return this.mode==="drawer-left"?(t="drawer",e="drawer-header",i+=" close-drawer close-drawer-right",o=`width:${this.width};left:0;`):this.mode==="drawer-right"?(t="drawer",e="drawer-header",i+=" close-drawer close-drawer-left",o=`width:${this.width};right:0;`):this.mode==="fullscreen"?o=`width:${window.outerWidth}px;height:${window.outerHeight}px;border-radius: 0`:i="",m`<div class="${I({wrapper:!0,open:this.open})}"><div class="overlay"></div><div class="${t}" style="${o}"><div class="${e}"></div><div class="${i}" @click="${this.closeWindow}"></div><iframe id="framePayment" class="obv-frameStyle" allowtransparency="true"></iframe><div class="orbit-spinner-text" style="${this.spinnerStyle()}"><span>${this.texts.TXT_CNX}</span></div><div class="orbit-spinner" style="${this.spinnerStyle()}"><div class="orbit one" style="${this.oribitStyle}"></div><div class="orbit two" style="${this.oribitStyle}"></div><div class="orbit three" style="${this.oribitStyle}"></div></div></div></div>`}close(){this.open=!1}}F(C,"styles",[D]);window.customElements.define("o21pay-dialog",C);const Z=.1,E=2.5,y=7;function v(r,t,e){return r===t?!1:(r-t<0?t-r:r-t)<=e+Z}function j(r,t){const e=Array.prototype.slice.call(O.create(r,{errorCorrectionLevel:t}).modules.data,0),i=Math.sqrt(e.length);return e.reduce((o,s,p)=>(p%i===0?o.push([s]):o[o.length-1].push(s))&&o,[])}const Y={generate(r,t,e,i="light"){const o=i==="light"?"#141414":"#fff",s=i==="light"?"#fff":"#141414",p=[],h=j(r,"Q"),l=t/h.length,S=[{x:0,y:0},{x:1,y:0},{x:0,y:1}];S.forEach(({x:d,y:n})=>{const c=(h.length-y)*l*d,a=(h.length-y)*l*n,u=.32;for(let g=0;g<S.length;g+=1){const b=l*(y-g*2);p.push(x`<rect fill="${g%2===0?o:s}" height="${b}" rx="${b*u}" ry="${b*u}" width="${b}" x="${c+l*g}" y="${a+l*g}">`)}});const _=Math.floor((e+25)/l),k=h.length/2-_/2,z=h.length/2+_/2-1,R=[];h.forEach((d,n)=>{d.forEach((c,a)=>{if(h[n][a]&&!(n<y&&a<y||n>h.length-(y+1)&&a<y||n<y&&a>h.length-(y+1))&&!(n>k&&n<z&&a>k&&a<z)){const u=n*l+l/2,g=a*l+l/2;R.push([u,g])}})});const f={};return R.forEach(([d,n])=>{f[d]?f[d].push(n):f[d]=[n]}),Object.entries(f).map(([d,n])=>{const c=n.filter(a=>n.every(u=>!v(a,u,l)));return[Number(d),c]}).forEach(([d,n])=>{n.forEach(c=>{p.push(x`<circle cx="${d}" cy="${c}" fill="${o}" r="${l/E}">`)})}),Object.entries(f).filter(([d,n])=>n.length>1).map(([d,n])=>{const c=n.filter(a=>n.some(u=>v(a,u,l)));return[Number(d),c]}).map(([d,n])=>{n.sort((a,u)=>a<u?-1:1);const c=[];for(const a of n){const u=c.find(g=>g.some(b=>v(a,b,l)));u?u.push(a):c.push([a])}return[d,c.map(a=>[a[0],a[a.length-1]])]}).forEach(([d,n])=>{n.forEach(([c,a])=>{p.push(x`<line x1="${d}" x2="${d}" y1="${c}" y2="${a}" stroke="${o}" stroke-width="${l/(E/2)}" stroke-linecap="round">`)})}),p}},H=w`.o21pay-logo{content:url(https://assets.obvious21.com/o21pay-assets/o21pay.png)}.pr-qrcode{position:relative;background-color:#000;padding:10px 10px 10px 10px;border-radius:15px;cursor:pointer}.pr-qrcode.shadow{box-shadow:rgba(0,0,0,.35) 0 5px 15px}.dark-theme{background-color:#000!important}.light-theme{background-color:#fff!important}@keyframes zoomIn{from{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}100%{opacity:1}}.zoomIn{-webkit-animation-name:zoomIn;animation-name:zoomIn}`;var Q=Object.defineProperty,U=(r,t,e)=>t in r?Q(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,W=(r,t,e)=>(U(r,typeof t!="symbol"?t+"":t,e),e);class P extends ${static get properties(){return{size:{type:String,attribute:"size"},theme:{type:String,attribute:"theme"},shadow:{type:Boolean,attribute:"shadow"},url:{type:String,attribute:"url"}}}constructor(){super(),this.theme="dark",this.size="320",this.shadow=!1,this.url="",this.eventsO21Pay=void 0}_onClick(t){const e={detail:{url:this.url},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("o21pay_QRclick",e))}render(){const t=this.url;if(!t||!t.length)return m``;this.size=parseInt(this.size)||"320",this.logoSize=this.size/3.3;const e=(this.size-this.logoSize)/2+9,i=(this.size-this.logoSize)/2+12,o=(p=>m`<svg height="${this.size}" width="${this.size}">${p}</svg>`)(Y.generate(this.url,this.size,this.size/4,this.theme));let s=`pr-qrcode ${this.theme}-theme`;return this.shadow&&(s+=" shadow"),m`
      <div id="qrsvg" class="${s}" style="width: ${this.size}px;height: ${this.size}px;">
        <svg height="${this.size}" width="${this.size}" @click="${this._onClick}">${o}</svg>
        <img
          class="o21pay-logo"
          height="${this.logoSize}"
          style="position: absolute; top: ${e}px; left: ${i}px;"
        />
      </div>
    `}}W(P,"styles",[H]);window.customElements.define("o21pay-qr",P);window.O21PayComponents={waitLoaded:async function(){return await Promise.allSettled([customElements.whenDefined("o21pay-qr"),customElements.whenDefined("o21pay-dialog"),customElements.whenDefined("o21pay-payment")]),!0}};
//# sourceMappingURL=all.min.js.map

import{css as w,LitElement as $,html as b,svg as x}from"lit";import{classMap as P}from"lit-html/directives/class-map.js";import I from"qrcode";const V=w`.o21pay-payment-full{display:inline-block;overflow:hidden;position:relative;box-shadow:rgb(0 0 0 / 35%) 0 5px 15px;transition:all .2s linear;border:1px solid #d3d3d3;padding:10px;cursor:initial;border-radius:15px;background-color:#fff}.o21pay-edit{text-align:center}.o21pay-input{font-size:18px;border:1px solid #d3d3d3;border-radius:5px;padding:10px;box-sizing:border-box}.o21pay-button{background-image:url(https://assets.obvious21.com/o21pay-assets/o21pay-button.png);background-repeat:no-repeat;background-size:auto 25px;background-position:22px 8px;background-color:#68d18d;border-color:#68d18d;color:#fff;font-weight:400;vertical-align:middle;border:1px solid transparent;background-position:top 10px;font-size:1rem;line-height:1.5;height:40px;width:140px;border-radius:20px;transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out}.o21pay-button:hover{color:#fff;background-color:#218838;border-color:#1e7e34}#amount{margin-top:5px;width:200px;text-align:center}#order_ref{margin-top:5px;width:200px;margin-bottom:3px;text-align:center}#page2{display:none}#o21pay-qr{float:left}@media screen and (max-width:1023px){.o21pay-p-vc{display:none}}@media only screen and (min-width:1024px){.o21pay-p-vc{vertical-align:middle;display:table-cell;height:190px;padding-left:20px;padding-right:20px;text-align:center}}.o21pay-poweredby{margin:0;font-size:12px;color:#778899}.close{z-index:9999;position:absolute;top:10px;right:15px;width:20px;height:20px;opacity:.3;cursor:pointer;visibility:hidden}.close:hover{opacity:1}.close:after,.close:before{position:absolute;left:15px;content:' ';height:20px;width:2px;background-color:#000}.close:before{transform:rotate(45deg)}.close:after{transform:rotate(-45deg)}.divider{position:absolute;left:220px;width:200px;bottom:70px;right:20px;border:2px solid #9fd3b1;border-radius:2px}`,B="http://localhost:3400/api/v1/";var M=Object.defineProperty,D=(i,e,t)=>e in i?M(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,L=(i,e,t)=>(D(i,typeof e!="symbol"?e+"":e,t),t);const Z=()=>navigator.userLanguage||navigator.languages&&navigator.languages.length&&navigator.languages[0]||navigator.language||navigator.browserLanguage||navigator.systemLanguage||"en";class E extends ${static get properties(){return{form:{type:Boolean,attribute:"form"},apiurl:{type:String,attribute:"apiurl"},merchant_id:{type:String,attribute:"merchant_id"},secretkey:{type:String,attribute:"secretkey"},amount:{type:String,attribute:"amount"},order_ref:{type:String,attribute:"order_ref"}}}constructor(){super(),this.form=!1,this.url="",this.amount="",this.apiurl=B,this.currency="EUR",navigator&&(this.locale=Z())}init(e,t){let r=this.renderRoot.querySelector(".o21pay-payment-full");r.style.removeProperty("height"),this.renderRoot.querySelector(".close").style.visibility="hidden",this.renderRoot.querySelector(".o21pay-edit").hidden=!1,r=this.renderRoot.querySelector("#page2"),r.style.display="none",e&&(this.amount=e),this.order_ref=t||""}async _paymentRequest(e,t,r,o,n){const p=this.apiurl+`merchants/${e}/paymentRequest`,h={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({secretkey:t,amount:r,currency_code:o,order_ref:n})},l=await(await fetch(p,h)).json();return l.data?l.data.url:(console.log(l),null)}async _onO21Pay(e){if(!this.merchant_id||!this.merchant_id.length){alert("Missing merchant_id");return}let t=this.renderRoot.querySelector("#amount");if(t){let o=t.value;o=o.replace(",","."),o=o.replace("\u20AC",""),this.amount=o}if(!this.amount||!this.amount.length){alert("Missing Amount");return}if(t=this.renderRoot.querySelector("#order_ref"),t&&(this.order_ref=t.value),!this.order_ref||!this.order_ref.length){alert("Missing order_ref");return}const r=await this._paymentRequest(this.merchant_id,this.secretkey,this.amount,"EUR",this.order_ref);if(r&&r.length){this.url=r;const o={detail:{url:this.url},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("o21pay_payment_request",o));let n=this.renderRoot.querySelector(".o21pay-payment-full");if(this.form){this.renderRoot.querySelector(".o21pay-edit").hidden=!0,n.style.height="200px",this.renderRoot.querySelector(".close").style.visibility="visible";const p=this;n=p.renderRoot.querySelector("o21pay-qr"),n.url=p.url,n=p.renderRoot.querySelector("#page2"),n.style.display="block"}else n&&(n.style.height="52px")}}onInit(e){this.init(this.amount,"")}onFocus(e){const t=e.target;return t.type="number",t.value=t.lastValue,t.value}onBlur(e){const t=e.target;t.value||(t.value=0),t.lastValue=t.value,this.amount=t.value}changeViewInput(e){let t=this.amount;t||(t=0),e.type="",e.lastValue=t,e.value=parseFloat(t).toLocaleString(this.locale,{style:"currency",maximumFractionDigits:2,minimumFractionDigits:2,currency:this.currency,currencyDisplay:"symbol"})}updated(e){if(e.has("amount")){console.log("updated ");const t=this.renderRoot.getElementById("amount");this.changeViewInput(t)}}render(){return this.form===!0?b`<div class="o21pay-payment-full"><div class="close" @click="${this.onInit}"></div><div class="o21pay-edit"><input id="amount" class="o21pay-input" type="number" min="0.00" max="15000.00" step="0.01" .value="${this.amount}" placeholder="0.00" @focus="${this.onFocus}" @blur="${this.onBlur}">   <input id="order_ref" class="o21pay-input" type="text" .value="${this.order_ref}" placeholder="Your Order Reference">   <button class="o21pay-button" @click="${this._onO21Pay}"></div><div id="page2"><o21pay-qr id="o21pay-qr" size="180" theme="dark" shadow></o21pay-qr><div class="o21pay-p-vc">To proceed to payment, you can either click on the QR-Code either scan with your mobile</div><hr class="divider"></div></div><div class="o21pay-poweredby"><svg style="position:relative;top:2px" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18 10.5C19.6569 10.5 21 11.8431 21 13.5V19.5C21 21.1569 19.6569 22.5 18 22.5H6C4.34315 22.5 3 21.1569 3 19.5V13.5C3 11.8431 4.34315 10.5 6 10.5V7.5C6 4.18629 8.68629 1.5 12 1.5C15.3137 1.5 18 4.18629 18 7.5V10.5ZM12 3.5C14.2091 3.5 16 5.29086 16 7.5V10.5H8V7.5C8 5.29086 9.79086 3.5 12 3.5ZM18 12.5H6C5.44772 12.5 5 12.9477 5 13.5V19.5C5 20.0523 5.44772 20.5 6 20.5H18C18.5523 20.5 19 20.0523 19 19.5V13.5C19 12.9477 18.5523 12.5 18 12.5Z" fill="currentColor"/></svg> <span>Payment secured and powered by O21Pay</span></div>`:b`<button class="o21pay-button" @click="${this._onO21Pay}">`}}L(E,"styles",[V]);window.customElements.define("o21pay-payment",E);const j=w`.wrapper{opacity:0;z-index:10;transition:opacity .25s ease-in}.wrapper:not(.open){visibility:hidden}.wrapper.open{opacity:1;visibility:visible}.overlay{background:rgba(0,0,0,.4);height:100%;width:100%;top:0;left:0;position:fixed}.dialog{background:#e1e4f0;border-radius:10px;padding:0;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:100px;height:100px;z-index:9998;box-shadow:rgba(0,0,0,.35) 0 5px 15px}.drawer{position:absolute;box-sizing:border-box;background-color:#e1e4f0;display:flex;flex-direction:column;overflow:hidden;outline:0;top:0;bottom:0;height:100%;z-index:9998;box-shadow:0 8px 10px -5px rgb(0 0 0 / 20%),0 16px 24px 2px rgb(0 0 0 / 14%),0 6px 30px 5px rgb(0 0 0 / 12%)}.drawer-header{align-items:center;color:#72767b;display:flex;margin-bottom:32px;padding:10px 20px 0}.close{z-index:9999;position:absolute;top:-25px;right:10px;width:20px;height:20px;opacity:.3;cursor:pointer}.close-drawer-left{top:10px!important;left:10px!important}.close-drawer-right{top:10px!important;right:20px!important}.close:hover{opacity:1}.close:after,.close:before{position:absolute;left:15px;content:" ";height:20px;width:2px;background-color:#000}.close:before{transform:rotate(45deg)}.close:after{transform:rotate(-45deg)}.orbit-spinner,.orbit-spinner *{box-sizing:border-box}.orbit-spinner{height:55px;width:55px;border-radius:50%;perspective:800px;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:48px;height:48px;z-index:2}.orbit-spinner .orbit{position:absolute;box-sizing:border-box;width:100%;height:100%;border-radius:50%}.orbit-spinner .orbit:nth-child(1){left:0;top:0;animation:orbit-spinner-orbit-one-animation 1.2s linear infinite;border-bottom:3px solid #ff1d5e}.orbit-spinner .orbit:nth-child(2){right:0;top:0;animation:orbit-spinner-orbit-two-animation 1.2s linear infinite;border-right:3px solid #ff1d5e}.orbit-spinner .orbit:nth-child(3){right:0;bottom:0;animation:orbit-spinner-orbit-three-animation 1.2s linear infinite;border-top:3px solid #ff1d5e}@keyframes orbit-spinner-orbit-one-animation{0%{transform:rotateX(35deg) rotateY(-45deg) rotateZ(0)}100%{transform:rotateX(35deg) rotateY(-45deg) rotateZ(360deg)}}@keyframes orbit-spinner-orbit-two-animation{0%{transform:rotateX(50deg) rotateY(10deg) rotateZ(0)}100%{transform:rotateX(50deg) rotateY(10deg) rotateZ(360deg)}}@keyframes orbit-spinner-orbit-three-animation{0%{transform:rotateX(35deg) rotateY(55deg) rotateZ(0)}100%{transform:rotateX(35deg) rotateY(55deg) rotateZ(360deg)}}.obv-frameContainerStyle{border-radius:10px}.obv-frameStyle{border:0;border-radius:10px}iframe{width:100%;height:100%}`;var Y=Object.defineProperty,X=(i,e,t)=>e in i?Y(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,A=(i,e,t)=>(X(i,typeof e!="symbol"?e+"":e,t),t);class R extends ${static get properties(){return{width:{type:String,attribute:"width"},height:{type:String,attribute:"height"},mode:{type:String,attribute:"mode"},url:{type:String},open:{type:Boolean},hideSpinner:{type:Boolean},events:{hasChanged(e,t){return!0}}}}constructor(){super(),this.open=!1,this.oribitStyle="borderColor: red; animationDuration: 1000ms;",this.width="375px",this.height="560px",this.modal="dialog"}updated(e){if(e.has("events")){const t=e.get("events"),r=this.events;t&&window.removeEventListener("message",t);const o=this;window.addEventListener("message",function(n){if(n&&n.data){const p=n.data;if(p){const h=p.message;if(h==="o21pay_ready"){const l=o.shadowRoot.getElementById("framePayment");l&&(l.style.opacity=1)}r&&h&&r(p)}}})}super.updated(e)}init(e,t,r,o="dialog"){if(!e||!e.length)return!1;t!==void 0&&(this.width=t),r!==void 0&&(this.height=r),o!==void 0&&(this.mode=o),this.hideSpinner=!1,e+=`&time=${new Date().getTime()}`;const n=this.renderRoot.querySelector("#framePayment");return n?(n.style.opacity=0,this.mode.indexOf("drawer")===-1&&e.indexOf("&close")===-1&&(e+="&close"),e.indexOf("&reset")===-1&&(e+="&reset"),n.src=e,!0):!1}reset(){const e=this.shadowRoot.getElementById("framePayment");e.src="about:blank"}spinnerStyle(){return"display: "+(this.hideSpinner?"none":"block")}closeWindow(){this.open=!1,this.events&&this.events({message:"o21pay_closed"}),this.reset()}render(){let e="dialog",t="",r="close",o=`width:${this.width}; height:${this.height}`;return this.mode==="drawer-left"?(e="drawer",t="drawer-header",r+=" close-drawer close-drawer-right",o=`width:${this.width};left:0;`):this.mode==="drawer-right"?(e="drawer",t="drawer-header",r+=" close-drawer close-drawer-left",o=`width:${this.width};right:0;`):this.mode==="fullscreen"?o=`width:${window.outerWidth}px;height:${window.outerHeight}px;border-radius: 0`:r="",b`<div class="${P({wrapper:!0,open:this.open})}"><div class="overlay"></div><div class="${e}" style="${o}"><div class="${t}"></div><div class="${r}" @click="${this.closeWindow}"></div><iframe id="framePayment" class="obv-frameStyle" allowtransparency="true"></iframe><div class="orbit-spinner" style="${this.spinnerStyle()}"><div class="orbit one" style="${this.oribitStyle}"></div><div class="orbit two" style="${this.oribitStyle}"></div><div class="orbit three" style="${this.oribitStyle}"></div></div></div></div>`}close(){this.open=!1}}A(R,"styles",[j]);window.customElements.define("o21pay-dialog",R);const F=.1,C=2.5,y=7;function v(i,e,t){return i===e?!1:(i-e<0?e-i:i-e)<=t+F}function H(i,e){const t=Array.prototype.slice.call(I.create(i,{errorCorrectionLevel:e}).modules.data,0),r=Math.sqrt(t.length);return t.reduce((o,n,p)=>(p%r===0?o.push([n]):o[o.length-1].push(n))&&o,[])}const Q={generate(i,e,t,r="light"){const o=r==="light"?"#141414":"#fff",n=r==="light"?"#fff":"#141414",p=[],h=H(i,"Q"),l=e/h.length,S=[{x:0,y:0},{x:1,y:0},{x:0,y:1}];S.forEach(({x:d,y:s})=>{const c=(h.length-y)*l*d,a=(h.length-y)*l*s,u=.32;for(let g=0;g<S.length;g+=1){const m=l*(y-g*2);p.push(x`<rect fill="${g%2===0?o:n}" height="${m}" rx="${m*u}" ry="${m*u}" width="${m}" x="${c+l*g}" y="${a+l*g}">`)}});const k=Math.floor((t+25)/l),z=h.length/2-k/2,_=h.length/2+k/2-1,q=[];h.forEach((d,s)=>{d.forEach((c,a)=>{if(h[s][a]&&!(s<y&&a<y||s>h.length-(y+1)&&a<y||s<y&&a>h.length-(y+1))&&!(s>z&&s<_&&a>z&&a<_)){const u=s*l+l/2,g=a*l+l/2;q.push([u,g])}})});const f={};return q.forEach(([d,s])=>{f[d]?f[d].push(s):f[d]=[s]}),Object.entries(f).map(([d,s])=>{const c=s.filter(a=>s.every(u=>!v(a,u,l)));return[Number(d),c]}).forEach(([d,s])=>{s.forEach(c=>{p.push(x`<circle cx="${d}" cy="${c}" fill="${o}" r="${l/C}">`)})}),Object.entries(f).filter(([d,s])=>s.length>1).map(([d,s])=>{const c=s.filter(a=>s.some(u=>v(a,u,l)));return[Number(d),c]}).map(([d,s])=>{s.sort((a,u)=>a<u?-1:1);const c=[];for(const a of s){const u=c.find(g=>g.some(m=>v(a,m,l)));u?u.push(a):c.push([a])}return[d,c.map(a=>[a[0],a[a.length-1]])]}).forEach(([d,s])=>{s.forEach(([c,a])=>{p.push(x`<line x1="${d}" x2="${d}" y1="${c}" y2="${a}" stroke="${o}" stroke-width="${l/(C/2)}" stroke-linecap="round">`)})}),p}},N=w`.o21pay-logo{content:url(https://assets.obvious21.com/o21pay-assets/o21pay.png)}.pr-qrcode{position:relative;background-color:#000;padding:10px 10px 10px 10px;border-radius:15px;cursor:pointer}.pr-qrcode.shadow{box-shadow:rgba(0,0,0,.35) 0 5px 15px}.dark-theme{background-color:#000!important}.light-theme{background-color:#fff!important}@keyframes zoomIn{from{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}100%{opacity:1}}.zoomIn{-webkit-animation-name:zoomIn;animation-name:zoomIn}`;var T=Object.defineProperty,U=(i,e,t)=>e in i?T(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,W=(i,e,t)=>(U(i,typeof e!="symbol"?e+"":e,t),t);class O extends ${static get properties(){return{size:{type:String,attribute:"size"},theme:{type:String,attribute:"theme"},shadow:{type:Boolean,attribute:"shadow"},url:{type:String,attribute:"url"}}}constructor(){super(),this.theme="dark",this.size="320",this.shadow=!1,this.url="",this.eventsO21Pay=void 0}_onClick(e){const t={detail:{url:this.url},bubbles:!0,composed:!0};this.dispatchEvent(new CustomEvent("o21pay_QRclick",t))}render(){const e=this.url;if(!e||!e.length)return b``;this.size=parseInt(this.size)||"320",this.logoSize=this.size/3.3;const t=(this.size-this.logoSize)/2+9,r=(this.size-this.logoSize)/2+12,o=(p=>b`<svg height="${this.size}" width="${this.size}">${p}</svg>`)(Q.generate(this.url,this.size,this.size/4,this.theme));let n=`pr-qrcode ${this.theme}-theme`;return this.shadow&&(n+=" shadow"),b`
      <div id="qrsvg" class="${n}" style="width: ${this.size}px;height: ${this.size}px;">
        <svg height="${this.size}" width="${this.size}" @click="${this._onClick}">${o}</svg>
        <img
          class="o21pay-logo"
          height="${this.logoSize}"
          style="position: absolute; top: ${t}px; left: ${r}px;"
        />
      </div>
    `}}W(O,"styles",[N]);window.customElements.define("o21pay-qr",O);window.O21PayComponents={waitLoaded:async function(){return await Promise.allSettled([customElements.whenDefined("o21pay-qr"),customElements.whenDefined("o21pay-dialog"),customElements.whenDefined("o21pay-payment")]),!0}};
//# sourceMappingURL=all.min.js.map
